16.
CREATE DEFINER=`root`@`localhost` FUNCTION `Count_Emp`(Dnumber INT) RETURNS int
DETERMINISTIC
BEGIN
DECLARE EmployeeCount Int;
SELECT
COUNT(*)
INTO EmployeeCount FROM
EMPLOYEE e
WHERE
e.Dno = Dnumber;
RETURN EmployeeCount;
END

17.
CREATE DEFINER=`root`@`localhost` PROCEDURE `Correct_Founded`()
BEGIN
UPDATE DEPT
SET Founded = '1960-01-01'
WHERE FOUNDED < '1960-01-01';
END

18.
delimiter $$
CREATE TRIGGER NO_MORE_THAN_8_EMPLOYEES BEFORE INSERT ON Employee
FOR EACH ROW
BEGIN
IF Count_Emp(NEW.Dno) >= 8 THEN
SIGNAL SQLSTATE '45000'
SET MESSAGE_TEXT = 'ERROR: NO MORE THAN 8 EMPLOYEES!';
END IF;
END; $$

19.
delimiter $$
CREATE TRIGGER BEFORE_ON_UPDATE_EMPLOYEE_DNO BEFORE UPDATE ON DEPT
FOR EACH ROW
BEGIN
UPDATE EMPLOYEE
SET Dno = NULL
WHERE Dno = OLD.Dnumber;
END; $$

delimiter $$
CREATE TRIGGER AFTER_ON_UPDATE_EMPLOYEE_DNO AFTER UPDATE ON DEPT
FOR EACH ROW
BEGIN
UPDATE EMPLOYEE
SET Dno = NEW.Dnumber
WHERE Dno is NULL;
END; $$

20.
CREATE DEFINER=`root`@`localhost` PROCEDURE `raise_procedure`(amount double, input_ssn int)
BEGIN
DECLARE old_SALARY double ;
DECLARE new_SALARY double ;
DECLARE difference double ;
SET new_SALARY = amount;

SELECT
SALARY
INTO old_SALARY FROM
EMPLOYEE
WHERE
Ssn = input_ssn;

set difference = new_Salary - old_SALARY;

UPDATE EMPLOYEE
SET
Salary = Salary + difference
WHERE
SSN = input_ssn;

UPDATE EMPLOYEE
SET
Salary = Salary + difference
WHERE
Ssn IN (SELECT
Mgr_ssn
FROM
DEPT
WHERE
Dnumber IN (SELECT
Dno
FROM
(SELECT
Dno
FROM
EMPLOYEE
WHERE
SSN = input_ssn
AND Dno IN (SELECT
Dnumber
FROM
(SELECT
d.Dnumber
FROM
EMPLOYEE e, DEPT d
WHERE
d.Mgr_ssn = e.ssn) AS A)) AS B));

END

21.
a.
Call Count_Emp(Integer) to use the function

b.
INSERT INTO `DEPT` (`Dnumber`, `Dname`, `Founded`, `Mgr_ssn`, `Budget`) VALUES (111, 'autem',
'1959-03-23', NULL, '403.642538')

after Calling Procedure the date is correctly adjusted to 1960-01-01

c.
INSERT INTO `EMPLOYEE` (`Ssn`, `Ename`, `Bdate`, `Dno`, `Salary`) VALUES (99998, 'eveniet',
'1979-01-31', 102, '59.2833')

If the department has 8 then it gives an error
Error Code: 1644. ERROR: NO MORE THAN 8 EMPLOYEES!

d.
Test Case:

SELECT *
FROM Employee
WHERE Dno = 102;

UPDATE DEPT
SET Dnumber = 500
WHERE Dnumber = 102;

select *
FROM EMPLOYEE
WHERE Dno = 500;

e.
Test Case:
SELECT *
FROM EMPLOYEE
WHERE SSN = 30;

SELECT *
FROM EMPLOYEE
WHERE SSN = 2;

call raise_procedure(200, 30);

SELECT *
FROM EMPLOYEE
WHERE SSN = 30;

SELECT *
FROM EMPLOYEE
WHERE SSN = 2;
